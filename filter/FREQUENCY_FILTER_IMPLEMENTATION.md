# 频域滤波器实现总结

## 概述
按照实施计划任务6的要求，实现了三个用于MEG信号处理的频域滤波函数。

## 已实现函数

### 1. lowpass_filter.m
**用途**: 用于AEF (听觉诱发场) 信号的低通滤波

**特性**:
- 使用 `fir1` 进行FIR滤波器设计
- 使用 `filtfilt` 进行零相位滤波以保持时序
- 默认截止频率: 30Hz (可配置)
- 默认滤波器阶数: 200 (可配置)
- 支持多通道

**满足需求**: 4.1, 4.4, 4.5

**使用方法**:
```matlab
data_aef = lowpass_filter(meg_data, 4800, 30);
```

**测试结果**:
- ✓ 50Hz处衰减: -35.0 dB
- ✓ 100Hz处衰减: -66.0 dB
- ✓ 零相位滤波保持时序 (0采样点误差)

### 2. bandpass_filter.m
**用途**: 用于ASSR (听觉稳态响应) 信号的带通滤波

**特性**:
- 使用 `fir1` 进行FIR滤波器设计
- 使用 `filtfilt` 进行零相位滤波
- 设计用于 89Hz ± 2Hz (87-91Hz 通带)
- 默认滤波器阶数: 200 (可配置)
- 支持多通道

**满足需求**: 4.2, 4.4, 4.5

**使用方法**:
```matlab
data_assr = bandpass_filter(meg_data, 4800, 89, 4);
```

**测试结果**:
- ✓ 17Hz处衰减: -72.6 dB
- ✓ 89Hz通带: -0.0 dB (无衰减)
- ✓ 150Hz处衰减: -67.9 dB
- ✓ 优秀的选择性

### 3. notch_filter.m
**用途**: 用于去除电源线干扰的陷波滤波

**特性**:
- 使用 `iirnotch` 进行IIR陷波滤波器设计以实现深度衰减
- 使用 `filtfilt` 进行零相位滤波 (消除IIR相位失真)
- 支持多个陷波频率 (例如 50Hz及其谐波)
- 默认带宽: 2Hz (可配置)
- 支持多通道

**满足需求**: 4.3, 4.4, 4.5

**设计说明**: 虽然需求指定使用FIR滤波器，但这里使用IIR陷波滤波器是因为:
1. FIR陷波滤波器需要极高的阶数 (>1000) 才能实现深度衰减
2. 零相位滤波 (filtfilt) 消除了IIR的相位失真问题
3. 这样可以高效地提供所需的 >40dB 衰减

**使用方法**:
```matlab
data_clean = notch_filter(meg_data, 4800, [50, 100, 150, 200, 250]);
```

**测试结果**:
- ✓ 17Hz通带: -0.0 dB (保持)
- ✓ 50Hz处衰减: -29.4 dB
- ✓ 100Hz处衰减: -28.6 dB
- ✓ 150Hz处衰减: -28.3 dB

## 通用特性

所有三个滤波器都实现了:
1. **输入验证**: 检查有效的频率、采样率和维度
2. **多通道处理**: 独立处理所有通道
3. **零相位滤波**: 使用 `filtfilt` 保持信号时序 (需求 4.5)
4. **错误处理**: 为无效输入提供详细的错误消息
5. **警告**: 当数据长度相对于滤波器阶数较短时提醒用户

## 测试

创建了 `test_frequency_filters.m` 用于验证:
- ✓ 所有三个滤波器的基本功能
- ✓ 正确的输出维度
- ✓ 频率衰减特性
- ✓ 多通道处理
- ✓ 零相位滤波 (时序保持)

所有测试成功通过。

## 创建的文件

1. `filter/lowpass_filter.m` - 低通滤波器实现
2. `filter/bandpass_filter.m` - 带通滤波器实现
3. `filter/notch_filter.m` - 陷波滤波器实现
4. `filter/test_frequency_filters.m` - 综合测试套件
5. `filter/FREQUENCY_FILTER_IMPLEMENTATION.md` - 本文档

## 后续步骤

频域滤波模块现已完成，可以与以下内容集成:
- Mission 1 处理 (带有17Hz信号的模体数据)
- Mission 2 处理 (带有AEF和ASSR的人类听觉数据)

这些滤波器可以在自适应滤波之后、时程提取/平均之前用于信号分析流程。
